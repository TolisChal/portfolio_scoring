function w = compute_weights(as, qs, vols, dists_dense, risk_fun, dispersion_fun)
    
    
    vols_vals = (vols - vols(1))*(1 ./(vols(end) - vols(1)));
    q_vals = risk_fun(vols_vals);
    
    q_vals = q_vals(2:(end-1));
    
    M1 = length(q_vals);
    
    w= [];
    
    for i = 1:M1
        a_seq = as{i};
        dists = dists_dense{i};
        interval_length = sum(dists);
        cum_sum_dists = cumsum(dists);
        
        a_vals_int = cum_sum_dists / interval_length;
        a_vals_int = sort(1 - a_vals_int);
        
        a_vals = dispersion_fun(a_vals_int);
        
        wi = q_vals(i);
        w = [w wi*a_vals];
    end
    
    w = w / sum(w);
end